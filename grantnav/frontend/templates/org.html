{% extends "base.html" %}
{% load frontend %}
{% load static %}
{% block main_content %}
<div class="layout layout--single-column">
  <main class="layout__content">
    <div class="spacer-1">
      <h1 class="heading-in-panel">{{ main_name }}</h1>
    </div>

    <div class="media-card media-card--base">
      <div class="media-card__content_no_image">
        <header class="media-card__header">
          <h3 class="media-card__heading">Organisation Information</h3>
        </header>


        <div class="media-card__box_container">

          <div class="media-card__box">
            <strong>Type</strong><br />
            {{org_types | join:",&nbsp;" }}
          </div>

          <div class="media-card__box">
            <strong>Org IDs</strong> <br/>
            {% for org_id in org_ids %}
            {{org_id}} &nbsp;
            {% endfor %}
          </div>

          <div class="media-card__box">
            <strong>Other Names</strong> <br/>
            {% if other_names %}
            {% for other_name in other_names %}
            {{other_name}} &nbsp;
            {% endfor %}
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <div class="spacer-4"></div>

    {% if funder %}
      {% include 'components/org-page-funder.html' %}
    {% endif  %}

    <div class="spacer-4"></div>
    {% if recipient %}
      {% include 'components/org-page-recipient.html' %}
    {% endif  %}

    <div class="spacer-4"></div>
    {% if publisher %}
      {% include 'components/org-page-publisher.html' %}
    {% endif  %}
  </main>
</div>
{% endblock %}
{% block extra_style %}
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.10/css/dataTables.bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.0.2/css/responsive.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/scroller/1.4.1/css/scroller.dataTables.min.css">
{% endblock %}
{% block extra_scripts %}
<script
  type="text/javascript"
  src="https://cdn.datatables.net/1.10.10/js/jquery.dataTables.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdn.datatables.net/responsive/2.0.2/js/dataTables.responsive.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdn.datatables.net/scroller/1.4.1/js/dataTables.scroller.min.js"
></script>

{{ funder.orgIDs|json_script:"orgIDs" }}

<script>
    function truncate(string, len){
      if (string.length > len)
          return string.substring(0,len)+'...';
      else
          return string;
    };

  jQuery(function($) {
    $('#recipients_datatable').dataTable({
      "serverSide": true,
      "responsive": true,
      "searching": true,
      "autoWidth": false,
      "scrollY": 400,
      "scroller": true,
      "dom": "fit",
      "scroller": {"displayBuffer": 15,
                    "loadingIndicator": true},
      "order": [[2, "desc"]],
      "language": {
          "info": "_START_ to _END_ of _TOTAL_",
          "search": "Search Recipients"
      },
      "ajax": {
        "url": "{% url 'funder_recipients_datatables' %}",
        "data": function ( d ) {
          d.funder_id = document.getElementById('orgIDs').textContent;
          d.currency = "{{funder.stats_by_currency.0.currency|escapejs}}";
        }
      },
      "columns": [
        {"data": "org_name", "width": "10px", "render": function (data, type, row) {
            return '<a href="/org/' + encodeURIComponent(row.org_id) + '">' + truncate(data, 20) + '</a>'
        }},
        {"data": "count"},
        {"data": "sum", "className": "amount"},
        {"data": "avg", "className": "amount"},
        {"data": "max", "className": "amount"},
        {"data": "min", "className": "amount"}
      ]
    });
  })
</script>
{% endblock %}
{% block modals %}
  {% include 'currency_stats_modal.html' %}
{% endblock %}
